{% extends "layout.html" %}

{% block title %}{{ g.account.name }}{% endblock %}

{% block body %}
  <h1 class="page-title">
    {{ self.title() }}
    <a href="{{ url_for('trades_create', account_id=g.account.account_id) }}" class="btn fr">
      + New Trade
    </a>
  </h1>

  <h2>Overview</h2>

  <div>
    TODO<br>
    account value, risk %,<br>
    gain/loss past week, gain/loss % past week<br>
    gain/loss past month, gain/loss % past month<br>
    gain/loss YTD, gain/loss % YTD<br>
    gain/loss past year, gain/loss % past year<br>
  </div>

  <h2>Trades</h2>

  <table class="table">
    <thead>
      <tr>
        <th class="tl">ID</th>
        <th class="tl">Symbol</th>
        <th class="tl">First O.</th>
        <th class="tl">Last O.</th>
        <th class="tr">Orders</th>
        <th class="tr">Avg. Buy/Sell Price</th>
        <th class="tr">Shares / ~Value</th>
        <th class="tr">P/L % / $</th>
      </tr>
    </thead>
    <tbody style="font-size: 0.85rem">
      {% for t in g.trades %}
        {% set trade_value = ((t.avg_buy_price or t.avg_sell_price) * t.quantity) %}
        <tr>
          <td>
            <a href="{{ url_for('trade', account_id=t.account_id, trade_id=t.trade_id) }}">
              #{{ t.trade_id }}
            </a>
          </td>
          <td>
            {{ t.symbol }}&nbsp;
            ({% if t.is_short %}short{% else %}long{% endif %})
          </td>
          <td>{{ t.first_order_date | format_datetime }}</td>
          <td>{{ t.last_order_date | format_datetime }}</td>
          <td class="tr">{{ t.orders_count }}</td>
          <td class="tr">
            ${{ t.avg_buy_price | format_number }}
            &nbsp;/&nbsp;
            ${{ t.avg_sell_price | format_number }}
          </td>
          <td class="tr">
            {{ t.quantity }}<br />
            ${{ trade_value | format_number }}
          </td>
          <td class="tr {% if t.profit >= 0 %}c-green{% else %}c-red{% endif %}">
            ${{ t.profit | format_number }}<br />
            {{ ((t.profit / trade_value) * 100 * 100000) | format_number }}%
          </td>
        </tr>
      {% else %}
        <tr><td colspan="8" class="tc">No trades yet.</td></tr>
      {% endfor %}
    </tbody>
  </table>
{% endblock %}
